/*!
 * jQuery TinyValidate plugin v1.6.3
 *
 * Date: Tue Dec 18 11:20:54 2012 EST
 * Requires: jQuery v1.4+
 *
 * Copyright 2011, Karl Swedberg
 * Dual licensed under the MIT and GPL licenses (just like jQuery):
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl.html
 *
 * A (relatively) tiny validation plugin
 *
 *
*/
(function(a){function z(j){if(/(input|textarea|select)/i.test(j))return"inputs";else if(/(div|fieldset|p)/i.test(j))return"containers"}function A(j){for(var m in j)if(j.hasOwnProperty(m))return false;return true}function B(){window.console&&window.console.log&&console.log.apply(console,arguments)}function C(j,m){return j.replace(/\{([^\|]+)\|([^}]+)\}/g,function(o,q,g){return m*1===1?q:g})}var D=document.createElement("input");a.each(["required","pattern"],function(j,m){a.support[m]=m in D});a.tinyvalidate=
{version:"1.6.3",callCounter:-1,maxnum:0,rules:{}};var p={};p.inputs={};p.containers={};a.fn.tinyvalidate=function(j){a.tinyvalidate.callCounter++;var m=a.tinyvalidate.callCounter?"_"+a.tinyvalidate.callCounter:"",o=a.tinyvalidate.rules;if(A(o))return B("you must have at least one rule. see jquery.tinyvalidate.rules.js","alert");this.find("*[required]").addClass("required").prop({required:false});return this.each(function(q){var g=a(this),k=a([]),h=a.extend(true,{},a.fn.tinyvalidate.defaults,j||{},
a.metadata?g.metadata():a.meta?g.data():{}),t=[],n=0,f=h.summary,r=f&&a(f.wrapper).hide(),l=h.inline,E=typeof h.otherEvents==="string"?h.otherEvents.split(/\s*,\s*/):h.otherEvents||[];m+=q?"-"+q:"";if(j==="removeErrors"){a.each(o,function(b,c){g.find("."+c.ruleClass).each(function(){k=k.add(a(this))})});k.removeData("error").trigger("removeNotice").trigger("toggleErrorClass");g.trigger("hideSummary");return this}if(f){a(f.insertTo==="form"?g[0]:f.insertTo)[f.insertType](r);if(f.lineItems)var s=f.lineItems.wrapper.match(/[^>]+>/g),
F=s[1]+s[0],v=f.lineItems.errorElement?f.lineItems.errorElement.match(/[^>]+>/g):["",""]}a.each(o,function(b,c){var d="."+c.ruleClass;g.find(d).each(function(){var e=z(this.nodeName)||"inputs",i=a(this),w=i.data("rule")||[],u=o[b],x=this.pattern;if(x)u=a.extend({},u,{rule:function(G){return RegExp(x).test(G)},text:"Field value is invalid."});if(!(this.nodeName==="DIV"&&i.has(d).length)){w.push(u);i.data("rule",w).data("ruleName",b).data("elementType",e);k=k.add(i);l&&i.data("insertion",p[e][l.insertType])}})});
if(l){l.errorElement&&k.bind("addNotice",function(b,c){var d=a(this),e=a.isFunction(d.data("rule")[c].text)?d.data("rule")[c].text.call(this,"inline",d):d.data("rule")[c].text,i=a(l.errorElement);i.html(e);i[a(this).data("insertion")](this).hide();i[l.errorAnimate.effect](l.errorAnimate.speed);d.bind("removeNotice",function(){i.remove()})});k.bind("toggleErrorClass",function(){var b,c=a(this);b=(b=c.is("select")&&c.closest("div.select"))&&b.length?b:c.find('input[type="checkbox"], input[type="radio"]').length?
c:c.closest(l.containerTag);c.data("error")?b.addClass(l.containerErrorClass):b.removeClass(l.containerErrorClass)})}if(f){g.bind("displaySummary",function(b,c){r.hide();if(c){var d=f.preMessage.replace(/\{num\}/g,c);d=C(d,c);d=f.lineItems?d+s[0]+t.join(F)+s[1]+f.postMessage:d+f.postMessage;r.html(d)[f.messageAnimate.effect](f.messageAnimate.speed)}});g.bind("hideSummary",function(){r.hide()});f.lineItems&&g.bind("lineItemBuilder",function(b,c,d){b=a(c);var e=a("<div></div>").html(b.data("elementType")===
"containers"?b.children().eq(0).html():b.prev().clone().html());e.children().remove();e=e.text().replace(/[\*:\s]+$/,"");d=a.isFunction(d.text)?d.text.call(this):d.text;if(f.lineItems.linkify)e='<a href="#'+(b.data("elementType")==="containers"?b.find("input")[0].id:c.id)+'">'+e+"</a>";t.push(e+" "+v[0]+d+v[1])})}k.bind("validate.tv",function(){var b=a(this).trigger("removeNotice"),c=b.data("rule"),d=c.length;b.removeData("error");for(var e=0;e<d;e++){c[e].elem&&c[e].elem(b);var i=c[e].check==="element"?
b:b.val();if(!c[e].rule(i)&&(!h.ignoreHidden||!b.is(":hidden"))&&(!h.ignoreDisabled||!this.disabled))if(!(b.is(".required")&&c[e].ruleClass!=="required"&&!b.val())){b.data("error","true").trigger("addNotice",[e]);g.trigger("lineItemBuilder",[this,c[e]]);n++}}b.trigger("toggleErrorClass")});g.bind("submit.tv",function(){n=0;t=[];k.trigger("validate.tv");g.trigger("displaySummary",[n]);if(n){h.submitError.call(g[0],n);return false}else if(h.submitOverride){g.tinyvalidate("removeErrors");h.submitOverride.call(g[0],
h);return false}});a.each(E,function(b,c){k.bind(c+".tv",function(d){var e=[9,16,17,18,91];if(!(d.type==="click"&&!/^(?:radio|checkbox)$/i.test(d.target.type)))if(!(d.type.indexOf("key")===0&&a.inArray(d.which,e)>-1)){n=0;a(this).trigger("validate.tv",[d]);h.onEvents.call(this,g)}})})})};a.fn.tinyvalidate.defaults={ignoreDisabled:true,ignoreHidden:true,otherEvents:"blur",onEvents:a.noop,submitError:function(){},submitOverride:null};a.fn.tinyvalidate.defaults.inline={insertType:"after",errorElement:'<div class="error-message"></div>',
errorAnimate:{effect:"fadeIn",speed:400},containerTag:"div",containerErrorClass:"error"};a.fn.tinyvalidate.defaults.summary={insertTo:"form",insertType:"append",wrapper:'<div class="error-summary"></div>',preMessage:"Please review the {num} highlighted {field|fields} and try again.<ul>",postMessage:"</ul>",messageAnimate:{effect:"fadeIn",speed:400},lineItems:{wrapper:"<li></li>",errorElement:'<span class="error-message"></span>',linkify:true}};var y={after:"insertAfter",insertAfter:"insertAfter",
before:"insertBefore",insertBefore:"insertBefore"};a.extend(p.inputs,y,{append:"insertAfter",appendTo:"insertAfter",prepend:"insertBefore",prependTo:"insertBefore"});a.extend(p.containers,y,{append:"appendTo",appendTo:"appendTo",prepend:"prependTo",prependTo:"prependTo"})})(jQuery);
